<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Display a map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" type="text/css" href="map.css" />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>

<div id='map'></div>
<!-- Modal to be populated on click -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-body" id="trs">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <div class="container">
            <div class="row">
                <div class="col">
                    <img src="" id="_trashimage" />
                </div>
                <div class="col">
                    <table>
                       <tbody>
                           <tr>
                               <th scope="row">Waste site type:</th>
                               <td id="wst"></td>
                           </tr>
                           <tr>
                                <th scope="row">Waste type:</th>
                                <td id="wt"></td>
                            </tr>
                            <tr>
                                <th scope="row">Trash size:</th>
                                <td id="ts"></td>
                            </tr>
                            <tr>
                                <th scope="row">Clean Up Method:</th>
                                <td id="cu"></td>
                            </tr>
                            <tr>
                                <th scope="row">Accessibility:</th>
                                <td id="at"></td>
                            </tr>
                            <tr>
                                <th scope="row">Foot access:</th>
                                <td id="fa"></td>
                            </tr>
                            <tr>
                                <th scope="row">Submitted:</th>
                                <td id="sd"></td>
                            </tr>
                    </tbody> 
                    </table>
                </div>

            </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>




mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/wkimacha/cjmhko2wnbl5l2rmqn1fetf5o', // stylesheet location
    center: [39.182384, -6.783038], // starting position [lng, lat]
    zoom: 9 // starting zoom
});


function flyToStore(currentFeature) {
  map.flyTo({
    center: currentFeature.geometry.coordinates,
    zoom: 18
  });
}

function createPopUp(currentFeature) {
  var popUps = document.getElementsByClassName('mapboxgl-popup');
  // Check if there is already a popup on the map and if so, remove it
  if (popUps[0]) popUps[0].remove();

var popup = new mapboxgl.Popup({closeOnClick: false})
    .setLngLat(currentFeature.geometry.coordinates)
    // .setHTML('<img src="'+ currentFeature.properties.image_path +'" class="image_path" />')
    .setHTML('<div><a href="#exampleModal" data-toggle="modal" class="img1" id="meta3"><img src="'+ currentFeature.properties.image_path +'" class="image_path"/></a></div>')

    .addTo(map);
}

//========================================//
var datas = map.querySourceFeatures("Dar_Trash_with_image_path-2m83ys", {sourceLayer:['dartrash']});

//-----------------------------------------------------------//
// //Js to control modal//
$(document).ready(function(){
    $("#meta3").click(function(){
        $("#met2").modal();
    });
});



 

// });
//-----------------------------------------------------------//
//MODALS//


// Add an event listener for when a user clicks on the map
map.on('click', function(e) {
  // Query all the rendered points in the view
  var features = map.queryRenderedFeatures(e.point, { layers: ['dartrash'] });
  //var source_features = map.querySourceFeatures("composite", {sourceLayer:['dartrash']});
  
  if (features.length) {
    var clickedPoint = features[0];
    // 1. Fly to the point
    flyToStore(clickedPoint);
    // 2. Close all other popups and display popup for clicked store
    createPopUp(clickedPoint);
    //image_modal(features);
  }
   
        $("#wst").text(clickedPoint.properties.waste_site_type); 
        $("#wt").text(clickedPoint.properties.waste_type);
        $("#ts").text(clickedPoint.properties.trash_size);
        $("#cu").text(clickedPoint.properties.clean_up_method);
        $("#at").text(clickedPoint.properties.access_type);
        $("#fa").text(clickedPoint.properties.foot_access);
        $("#sd").text(clickedPoint.properties._submission_time);
        $("#_trashimage").attr('src',clickedPoint.properties.image_path);
});







$('#exampleModal').on('hidden.bs.modal', function () {
    $('#exampleModal').reset();
    });
//----------------------------------------------------------------------------//
//Cursor//
    // Change the cursor to a pointer when the mouse is over the places layer.
    map.on('mouseenter', 'dartrash', function () {
        map.getCanvas().style.cursor = 'pointer';
    });

    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'dartrash', function () {
        map.getCanvas().style.cursor = '';
    });
//--------------------------------------------------------------------//
//Geoloacate//
// Add geolocate control to the map.
map.addControl(new mapboxgl.GeolocateControl({
    positionOptions: {
        enableHighAccuracy: true
    },
    trackUserLocation: true
}));
//------------------------------------------------------------//
//Show truncated text on hover//
 $(document).on('mouseenter', ".text-truncate", function () {
     var $this = $(this);
     if (this.offsetWidth < this.scrollWidth && !$this.attr('title')) {
         $this.tooltip({
             title: $this.text(),
             placement: "bottom"
         });
         $this.tooltip('show');
     }
 });

les = "it works";


</script>

</body>
</html>
